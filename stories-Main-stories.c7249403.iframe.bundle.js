"use strict";(self.webpackChunkasync_queued=self.webpackChunkasync_queued||[]).push([[611],{"./src/stories/Main.stories.jsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{HighMsRequests:()=>HighMsRequests,LowMsRequests:()=>LowMsRequests,default:()=>Main_stories});var preact_module=__webpack_require__("./node_modules/preact/dist/preact.module.js"),_=0;function o(o,e,n,t,f,l){var s,u,a={};for(u in e)"ref"==u?s=e[u]:a[u]=e[u];var i={type:o,props:a,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--_,__source:f,__self:l};if("function"==typeof o&&(s=o.defaultProps))for(u in s)void 0===a[u]&&(a[u]=s[u]);return preact_module.YM.vnode&&preact_module.YM.vnode(i),i}const Card=({children})=>o("div",{children}),Container=({containerHeading,isLoading,children})=>o("div",{style:{flex:"0.5"},children:[o("h1",{style:{textAlign:"center"},children:containerHeading}),isLoading?o("h3",{children:"loading..."}):null,o("div",{style:{display:"flex",gap:"5px",flexWrap:"wrap"},children})]});function Compose({promiseState,isPromiseStateLoading,queueState,isQueueStateLoading}){return o("div",{style:{display:"flex",flexDirection:"row"},children:[o(Container,{containerHeading:"Queue",isLoading:isQueueStateLoading,children:queueState&&queueState.map((({time,rnd})=>o(Card,{children:o("div",{children:[o("span",{children:[o("b",{children:"time"}),": ",time,"ms"," "]}),o("span",{children:[o("b",{children:"itemData"}),": ",rnd.toFixed(1)]})]})},Math.random())))}),o(Container,{containerHeading:"Promise",isLoading:isPromiseStateLoading,children:promiseState&&promiseState.map((({time,rnd})=>o(Card,{children:o("div",{children:[o("span",{children:[o("b",{children:"time"}),": ",time,"ms"," "]}),o("span",{children:[o("b",{children:"itemData"}),": ",rnd.toFixed(1)]})]})},Math.random())))})]})}var hooks_module=__webpack_require__("./node_modules/preact/hooks/dist/hooks.module.js");class LocalEmitter{subscribers=new Map;emit(emittedEvent){this.subscribers.forEach(((set,event)=>{emittedEvent===event&&set.forEach((fn=>{fn()}))}))}subscribe(event,fn){const set=this.subscribers.get(event);set?(set.add(fn),this.subscribers.set(event,set)):this.subscribers.set(event,new Set([fn]))}unsubscribe(event,fn){const set=this.subscribers.get(event);set&&set.delete(fn)}}class CreateAsyncQueue{resulted=[];isRunning=!1;constructor(useIteration,iterationProps){this.emitter=new LocalEmitter,this.initialization(useIteration,iterationProps),this.bindFunctions()}initialization(useIteration,iterationProps){this.useIteration=useIteration,this.setToDefault(),this.fillQueue(structuredClone(iterationProps)),this.queueSet=this.getQueue(),this.processedSet=this.getProcessed()}getQueue(){return this.queue.get("queue")}getProcessed(){return this.queue.get("processed")}bindFunctions(){this.resume=this.resume.bind(this),this.stop=this.stop.bind(this),this.push=this.push.bind(this),this.run=this.run.bind(this),this.getResultedData=this.getResultedData.bind(this),this.getProcessedData=this.getProcessedData.bind(this),this.getQueueData=this.getQueueData.bind(this),this.resetAll=this.resetAll.bind(this)}fillQueue(iterationProps){this.queue.set("queue",iterationProps||[]),this.queue.set("processed",[])}async*gen(){for(let prop of[...this.queueSet]){if(this.emitRunning(),this.options.isAborted)return void this.emitStopping();const preparedData=Array.isArray(prop)?[...prop]:[prop];yield await this.useIteration(...preparedData),this.queueSet.pop(),this.processedSet.push(prop),this.emitStopping()}}async run(callback,isCallbackShouldBeSkipped=!1){return this.runWithOption(this,callback,isCallbackShouldBeSkipped)}async runWithResult(callback,isCallbackShouldBeSkipped=!1){return this.runWithOption(this.resulted,callback,isCallbackShouldBeSkipped)}async runWithOption(resultOption,callback,isCallbackShouldBeSkipped=!1){if(callback&&(this.runCallback=callback),this.isRunning&&await this.awaitRunning(),!this.queueSet.length)return resultOption;const establishedCallback=this.runCallback;for await(let item of this.gen())if(establishedCallback&&!isCallbackShouldBeSkipped){const res=await establishedCallback(item);this.resulted.push(res)}return resultOption}awaitRunning(){return new Promise((res=>{this.emitter.subscribe("stopping",res)}))}emitRunning(){this.isRunning=!0,this.emitter.emit("running")}emitStopping(){this.isRunning=!1,this.emitter.emit("stopping")}setToDefault(){this.options={isAborted:!1},this.queue=new Map,this.resulted=[]}getProcessedData(){return[...this.getProcessed()]}getQueueData(){return[...this.getQueue()]}getResultedData(){return this.resulted}resetAll(iterationProps){return this.setToDefault(),this.fillQueue(iterationProps),this}stop(){return this.options.isAborted=!0,this}resume(){return this.options.isAborted=!1,this.queueSet.length?this.run():this}push(data){return data.forEach((item=>this.queueSet.push(item))),this}}function waiter(time=1e3){return new Promise((res=>{setTimeout((()=>{res({time,rnd:Math.random()})}),time)}))}const Main_stories={title:"Example/Requests",component:Compose,argTypes:{arrayOfPromisesLength:{control:"number"},lastItemOfPromisesArray:{control:"number"}}},ComposeWithData=({data=[]})=>{const preparedDataForPromise=data.map((d=>waiter(d))),[promiseState,isPromiseStateLoading,triggerPromise]=function usePromise(loadData){const[state,setState]=(0,hooks_module.eJ)(void 0),[reTrigger,setReTrigger]=(0,hooks_module.eJ)(!1),[isLoading,setIsLoading]=(0,hooks_module.eJ)(!1);function createAndTrigger(){setIsLoading(!0),Promise.all(loadData).then((data=>{setState([].concat(...data))})).finally((()=>setIsLoading(!1)))}return(0,hooks_module.d4)((()=>{createAndTrigger()}),[]),(0,hooks_module.d4)((()=>{reTrigger&&!state&&(createAndTrigger(),setReTrigger(!1))}),[reTrigger]),[state,isLoading,()=>{setReTrigger(!0),setState(void 0)}]}(preparedDataForPromise),[queueState,isQueueStateLoading,triggerQueue]=function useQueue(loadFunction,loadData){const[state,setState]=(0,hooks_module.eJ)([]),[reTrigger,setReTrigger]=(0,hooks_module.eJ)(!1),[isLoading,setIsLoading]=(0,hooks_module.eJ)(!1);function createAndTrigger(){state.length&&setState([]),setIsLoading(!0),new CreateAsyncQueue(loadFunction,loadData).run((value=>{setState((prev=>[...prev,value]))})).then((()=>setIsLoading(!1)))}return(0,hooks_module.d4)((()=>{createAndTrigger()}),[]),(0,hooks_module.d4)((()=>{reTrigger&&(createAndTrigger(),setReTrigger(!1))}),[reTrigger]),[state,isLoading,()=>setReTrigger(!0)]}(waiter,data),props={promiseState,queueState,isPromiseStateLoading,isQueueStateLoading};return o(preact_module.HY,{children:[o("button",{style:{margin:"0 auto",cursor:"pointer"},onClick:function triggerHandler(){triggerQueue(),triggerPromise()},children:"Re-trigger"}),o(Compose,{...props})]})},LowMsRequests={render:({arrayOfPromisesLength,lastItemOfPromisesArray})=>{const data=new Array(arrayOfPromisesLength||200).fill().map(((_,i)=>1)).concat(lastItemOfPromisesArray||6e3);return o(ComposeWithData,{data})}},HighMsRequests={render:({arrayOfPromisesLength,lastItemOfPromisesArray})=>{const data=new Array(arrayOfPromisesLength||200).fill().map(((_,i)=>2e3)).concat(lastItemOfPromisesArray||6e3);return o(ComposeWithData,{data})}};LowMsRequests.parameters={...LowMsRequests.parameters,docs:{...LowMsRequests.parameters?.docs,source:{originalSource:"{\n  render: ({\n    arrayOfPromisesLength,\n    lastItemOfPromisesArray\n  }) => {\n    const data = new Array(arrayOfPromisesLength || 200).fill().map((_, i) => 1).concat(lastItemOfPromisesArray || 6000);\n    return <ComposeWithData data={data} />;\n  }\n}",...LowMsRequests.parameters?.docs?.source}}},HighMsRequests.parameters={...HighMsRequests.parameters,docs:{...HighMsRequests.parameters?.docs,source:{originalSource:"{\n  render: ({\n    arrayOfPromisesLength,\n    lastItemOfPromisesArray\n  }) => {\n    const data = new Array(arrayOfPromisesLength || 200).fill().map((_, i) => 2000).concat(lastItemOfPromisesArray || 6000);\n    return <ComposeWithData data={data} />;\n  }\n}",...HighMsRequests.parameters?.docs?.source}}}},"./node_modules/preact/hooks/dist/hooks.module.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{I4:()=>T,Me:()=>V,Qb:()=>x,Ye:()=>F,_Y:()=>s,aP:()=>A,bt:()=>y,cO:()=>P,d4:()=>p,eJ:()=>h,qp:()=>q,sO:()=>_});var t,r,u,i,preact__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/preact/dist/preact.module.js"),o=0,f=[],c=[],e=preact__WEBPACK_IMPORTED_MODULE_0__.YM.__b,a=preact__WEBPACK_IMPORTED_MODULE_0__.YM.__r,v=preact__WEBPACK_IMPORTED_MODULE_0__.YM.diffed,l=preact__WEBPACK_IMPORTED_MODULE_0__.YM.__c,m=preact__WEBPACK_IMPORTED_MODULE_0__.YM.unmount;function d(t,u){preact__WEBPACK_IMPORTED_MODULE_0__.YM.__h&&preact__WEBPACK_IMPORTED_MODULE_0__.YM.__h(r,t,o||u),o=0;var i=r.__H||(r.__H={__:[],__h:[]});return t>=i.__.length&&i.__.push({__V:c}),i.__[t]}function h(n){return o=1,s(B,n)}function s(n,u,i){var o=d(t++,2);if(o.t=n,!o.__c&&(o.__=[i?i(u):B(void 0,u),function(n){var t=o.__N?o.__N[0]:o.__[0],r=o.t(t,n);t!==r&&(o.__N=[r,o.__[1]],o.__c.setState({}))}],o.__c=r,!r.u)){var f=function(n,t,r){if(!o.__c.__H)return!0;var u=o.__c.__H.__.filter((function(n){return n.__c}));if(u.every((function(n){return!n.__N})))return!c||c.call(this,n,t,r);var i=!1;return u.forEach((function(n){if(n.__N){var t=n.__[0];n.__=n.__N,n.__N=void 0,t!==n.__[0]&&(i=!0)}})),!(!i&&o.__c.props===n)&&(!c||c.call(this,n,t,r))};r.u=!0;var c=r.shouldComponentUpdate,e=r.componentWillUpdate;r.componentWillUpdate=function(n,t,r){if(this.__e){var u=c;c=void 0,f(n,t,r),c=u}e&&e.call(this,n,t,r)},r.shouldComponentUpdate=f}return o.__N||o.__}function p(u,i){var o=d(t++,3);!preact__WEBPACK_IMPORTED_MODULE_0__.YM.__s&&z(o.__H,i)&&(o.__=u,o.i=i,r.__H.__h.push(o))}function y(u,i){var o=d(t++,4);!preact__WEBPACK_IMPORTED_MODULE_0__.YM.__s&&z(o.__H,i)&&(o.__=u,o.i=i,r.__h.push(o))}function _(n){return o=5,F((function(){return{current:n}}),[])}function A(n,t,r){o=6,y((function(){return"function"==typeof n?(n(t()),function(){return n(null)}):n?(n.current=t(),function(){return n.current=null}):void 0}),null==r?r:r.concat(n))}function F(n,r){var u=d(t++,7);return z(u.__H,r)?(u.__V=n(),u.i=r,u.__h=n,u.__V):u.__}function T(n,t){return o=8,F((function(){return n}),t)}function q(n){var u=r.context[n.__c],i=d(t++,9);return i.c=n,u?(null==i.__&&(i.__=!0,u.sub(r)),u.props.value):n.__}function x(t,r){preact__WEBPACK_IMPORTED_MODULE_0__.YM.useDebugValue&&preact__WEBPACK_IMPORTED_MODULE_0__.YM.useDebugValue(r?r(t):t)}function P(n){var u=d(t++,10),i=h();return u.__=n,r.componentDidCatch||(r.componentDidCatch=function(n,t){u.__&&u.__(n,t),i[1](n)}),[i[0],function(){i[1](void 0)}]}function V(){var n=d(t++,11);if(!n.__){for(var u=r.__v;null!==u&&!u.__m&&null!==u.__;)u=u.__;var i=u.__m||(u.__m=[0,0]);n.__="P"+i[0]+"-"+i[1]++}return n.__}function b(){for(var t;t=f.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(k),t.__H.__h.forEach(w),t.__H.__h=[]}catch(r){t.__H.__h=[],preact__WEBPACK_IMPORTED_MODULE_0__.YM.__e(r,t.__v)}}preact__WEBPACK_IMPORTED_MODULE_0__.YM.__b=function(n){r=null,e&&e(n)},preact__WEBPACK_IMPORTED_MODULE_0__.YM.__r=function(n){a&&a(n),t=0;var i=(r=n.__c).__H;i&&(u===r?(i.__h=[],r.__h=[],i.__.forEach((function(n){n.__N&&(n.__=n.__N),n.__V=c,n.__N=n.i=void 0}))):(i.__h.forEach(k),i.__h.forEach(w),i.__h=[])),u=r},preact__WEBPACK_IMPORTED_MODULE_0__.YM.diffed=function(t){v&&v(t);var o=t.__c;o&&o.__H&&(o.__H.__h.length&&(1!==f.push(o)&&i===preact__WEBPACK_IMPORTED_MODULE_0__.YM.requestAnimationFrame||((i=preact__WEBPACK_IMPORTED_MODULE_0__.YM.requestAnimationFrame)||j)(b)),o.__H.__.forEach((function(n){n.i&&(n.__H=n.i),n.__V!==c&&(n.__=n.__V),n.i=void 0,n.__V=c}))),u=r=null},preact__WEBPACK_IMPORTED_MODULE_0__.YM.__c=function(t,r){r.some((function(t){try{t.__h.forEach(k),t.__h=t.__h.filter((function(n){return!n.__||w(n)}))}catch(u){r.some((function(n){n.__h&&(n.__h=[])})),r=[],preact__WEBPACK_IMPORTED_MODULE_0__.YM.__e(u,t.__v)}})),l&&l(t,r)},preact__WEBPACK_IMPORTED_MODULE_0__.YM.unmount=function(t){m&&m(t);var r,u=t.__c;u&&u.__H&&(u.__H.__.forEach((function(n){try{k(n)}catch(n){r=n}})),u.__H=void 0,r&&preact__WEBPACK_IMPORTED_MODULE_0__.YM.__e(r,u.__v))};var g="function"==typeof requestAnimationFrame;function j(n){var t,r=function(){clearTimeout(u),g&&cancelAnimationFrame(t),setTimeout(n)},u=setTimeout(r,100);g&&(t=requestAnimationFrame(r))}function k(n){var t=r,u=n.__c;"function"==typeof u&&(n.__c=void 0,u()),r=t}function w(n){var t=r;n.__c=n.__(),r=t}function z(n,t){return!n||n.length!==t.length||t.some((function(t,r){return t!==n[r]}))}function B(n,t){return"function"==typeof t?t(n):t}}}]);